# 消息队列

## 消息队列协议

协议：消息中间件负责数据的传递、存储和分发消费三个部分，数据的存储和分发过程中肯定要遵循某种约定成俗的规范，是采用底层的 TCP/IP、UDP 协议还是自己构建等，而这些约定俗成的规范称之为协议

### 网络协议的三要素

1. 语法：http 规定了请求报文和响应报文的格式
2. 语义：客户端主动发起请求称之为请求
3. 时序：一个请求对应一个响应，一定是先有请求再有响应

消息中间价采用的并不是 http 协议，常见的消息中间件协议有：OpenWire、AMQP、MQTT、Kafka、OpenMessage 协议

> 面试题：为什么消息中间件不直接使用 http 协议
>
> 1. http 协议的请求报文头和响应报文头比较复杂，包含了 cookie、数据的加密解密、响应码等附加功能，而对于一个消息而言并不需要这么复杂，它其实就是负责数据传递、存储、分发，追求高性能、尽量简洁
> 2. 大部分情况下 http 是短链接，一个请求到响应很可能中断，造成请求的丢失，这不利于消息中间件的业务场景，要保证消息和数据的可靠性和稳健性

### AMQP 协议

AMQP：(Advanced Message Queuing Protocol) 高级消息队列协议。

特性：

1. 分布式事务支持
2. 消息的持久化支持
3. 高性能和高可靠的消息处理优势

支持者：RabbitMQ、ActiveMQ

### MQTT 协议

MQTT：(Message Queuing Telemetry Transport) 即使通讯协议，物联网系统架构中的重要组成部分

特性：

1. 轻量
2. 结构简单
3. 传输快，不支持事务
4. 没有持久化设计

应用场景：计算能力有限、低带宽、网络不稳定的场景

支持者：RabbitMQ、ActiveMQ

### OpenMessage 协议

最近几年由阿里、雅虎和滴滴等公司共同参与的与创立的分布式消息中间件、流处理等领域的应用开发标准

特性：

1. 结构简单
2. 解析速度快
3. 支持事务和持久化

### Kafaka 协议

基于 TCP/IP 的二进制协议。消息内部是通过长度来分割，由一些基本数据类型组成

1. 结构简单
2. 解析速度快
3. 支持持久化
4. 无事务支持

## 为什么需要 MQ

- 流量消峰

- 应用解耦

- 异步处理