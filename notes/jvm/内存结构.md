# 内存结构

## 程序计数器(Program Counter Register)

### 定义

程序计数器是存放下一条指令所在的单元的地址的地方

### 作用

当执行一条指令时，首先需要根据PC中存放的指令地址，将指令由内存取到指令寄存器中，此过程称为“取指令”。与此同时，PC中的地址或自动加1或由转移指针给出下一条指令的地址。此后经过分析指令，执行指令。完成第一条指令的执行，而后根据PC取出第二条指令的地址，如此循环，执行每一条指令

![](../../images/20210914232512.png)

程序计数器会将 jvm 指令交给解释器解释为机器码，再将机器码将给 cpu 执行

### 特点

- 每个线程私有
- 不会存在内存溢出

## 虚拟机栈

Java Virtual Machine Stacks (Java 虚拟机栈)

每个线程只能有一个活动栈帧，对应着当前正在执行的那个方法

问题辨析

- 垃圾回收是否涉及栈内存
  
  垃圾回收不涉及也不需要处理栈内存

- 栈内存分配越大越好吗
  
  可以通过 -Xss 指定栈内存大小。栈内存分配越大，只是能够进行更多次的方法递归调用，但线程数会变少，并不一定会越来越好，反而可能影响性能

- 方法内的局部变量是否线程安全
  
  - 如果方法内局部变量没有逃离方法的作用范围，它是线程安全的
  - 如果是局部变量引用了对象，并逃离了方法的作用范围，需要考虑线程安全
